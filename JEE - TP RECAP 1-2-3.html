<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP - Fondamentaux JEE pour Big Data (Séances 1-3) - Contexte IoT</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
        }
        h2 {
            color: #e74c3c;
            margin-top: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        h3 {
            color: #34495e;
            margin-top: 20px;
        }
        p {
            margin-bottom: 10px;
        }
        ul {
            list-style-type: disc;
            margin-left: 20px;
            margin-bottom: 10px;
        }
        ol {
            list-style-type: decimal;
            margin-left: 20px;
            margin-bottom: 10px;
        }
        li {
            margin-bottom: 8px;
        }
        .concept {
            background-color: #ecf0f1;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        .note {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .warning {
            background-color: #f8d7da;
            border-left: 5px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            color: #721c24;
        }
        .task {
            background-color: #e8f5e8;
            border-left: 5px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        code {
            background-color: #f0f0f0;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
        }
        .architecture-diagram {
            text-align: center;
            margin: 30px 0;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .architecture-diagram h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .component {
            display: inline-block;
            margin: 10px;
            padding: 15px 20px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background-color: #ecf0f1;
            color: #2c3e50;
            font-weight: bold;
            font-size: 0.9em;
            vertical-align: top;
        }
        .arrow {
            display: inline-block;
            margin: 0 10px;
            font-size: 2em;
            color: #3498db;
            vertical-align: middle;
        }
        .layer {
            border: 1px dashed #95a5a6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            background-color: #fdfefe;
        }
        .layer-title {
            font-weight: bold;
            color: #7f8c8d;
            margin-bottom: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Travaux Pratiques - Fondamentaux JEE pour Big Data (Contexte IoT)</h1>
        <p><strong>Durée estimée :</strong> 4 heures</p>
        <p>Ce TP vise à consolider les concepts abordés lors des séances 1, 2 et 3 du module Java JEE pour l'Ingénierie Big Data. Vous allez développer une application web simple mais structurée, intégrant les bases de JEE, CDI, les patterns architecturaux et une introduction à la conteneurisation, le tout dans un contexte de gestion de données issues de l'Internet des Objets (IoT).</p>

        <div class="note">
            <strong>Prérequis :</strong>
            <ul>
                <li>Environnement de développement configuré (IntelliJ IDEA Ultimate).</li>
                <li>Serveur d'applications WildFly ou Payara installé et fonctionnel.</li>
                <li>Docker installé et configuré.</li>
                <li>Connaissances de base en Java et Maven.</li>
            </ul>
        </div>

        <h2>Contexte du Projet : Plateforme de Collecte et Visualisation de Données IoT</h2>
        <p>Vous travaillez sur le module d'ingestion et de visualisation initiale d'une plateforme IoT. Cette plateforme doit être capable de recevoir des données de divers capteurs (température, humidité, pression, etc.) déployés dans un environnement (ex: une usine, une ville intelligente). Pour cette première phase, nous allons simuler la réception de ces données et les afficher via une interface web simple. L'objectif est de poser les bases d'une architecture robuste et scalable pour le traitement futur de ces données massives.</p>
        <p>Une "lecture de capteur" (<code>SensorReading</code>) sera caractérisée par :</p>
        <ul>
            <li>Un identifiant unique de la lecture (<code>String readingId</code>)</li>
            <li>L'ID du capteur (<code>String sensorId</code>)</li>
            <li>Le type de capteur (<code>String sensorType</code>, ex: "TEMPERATURE", "HUMIDITY", "PRESSURE", "CO2")</li>
            <li>La valeur mesurée (<code>double value</code>)</li>
            <li>L'unité de mesure (<code>String unit</code>, ex: "°C", "%", "hPa", "ppm")</li>
            <li>L'horodatage de la lecture (<code>long timestamp</code>)</li>
            <li>L'emplacement du capteur (<code>String location</code>, ex: "Salle des serveurs", "Atelier 1", "Extérieur Nord")</li>
        </ul>

        <div class="architecture-diagram">
            <h3>Schéma d'Architecture Simplifié du TP</h3>
            <svg width="800" height="400" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
                <!-- Definitions for arrows -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#3498db" />
                    </marker>
                </defs>

                <!-- Capteurs IoT (Source de données) -->
                <g transform="translate(50, 50)">
                    <rect x="0" y="0" width="100" height="60" rx="10" ry="10" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
                    <text x="50" y="35" font-family="Segoe UI" font-size="14" fill="white" text-anchor="middle">Capteurs IoT</text>
                </g>
                <g transform="translate(50, 130)">
                    <rect x="0" y="0" width="100" height="60" rx="10" ry="10" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
                    <text x="50" y="35" font-family="Segoe UI" font-size="14" fill="white" text-anchor="middle">Capteurs IoT</text>
                </g>
                <line x1="150" y1="80" x2="250" y2="80" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead)" />
                <line x1="150" y1="160" x2="250" y2="160" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead)" />
                <text x="200" y="70" font-family="Segoe UI" font-size="12" fill="#3498db" text-anchor="middle">Envoi de données</text>

                <!-- Application JEE (Conteneur Docker) -->
                <rect x="250" y="20" width="400" height="300" rx="15" ry="15" fill="#f0f8ff" stroke="#3498db" stroke-width="3" stroke-dasharray="5,5"/>
                <text x="450" y="45" font-family="Segoe UI" font-size="16" fill="#3498db" text-anchor="middle">Application JEE (Conteneur Docker)</text>

                <!-- Couche Web (Servlet/JSP) -->
                <rect x="270" y="60" width="360" height="80" rx="8" ry="8" fill="#e74c3c" stroke="#c0392b" stroke-width="1"/>
                <text x="450" y="105" font-family="Segoe UI" font-size="14" fill="white" text-anchor="middle">Couche Web (Servlet Controller / JSP View)</text>
                <line x1="450" y1="140" x2="450" y2="170" stroke="#3498db" stroke-width="1" marker-end="url(#arrowhead)" />
                <text x="460" y="155" font-family="Segoe UI" font-size="12" fill="#3498db">Appel Service</text>

                <!-- Couche Service (CDI) -->
                <rect x="270" y="170" width="360" height="80" rx="8" ry="8" fill="#f1c40f" stroke="#f39c12" stroke-width="1"/>
                <text x="450" y="215" font-family="Segoe UI" font-size="14" fill="#2c3e50" text-anchor="middle">Couche Service (IoTSensorManagerService - CDI)</text>
                <line x1="450" y1="250" x2="450" y2="280" stroke="#3498db" stroke-width="1" marker-end="url(#arrowhead)" />
                <text x="460" y="265" font-family="Segoe UI" font-size="12" fill="#3498db">Appel DAO</text>

                <!-- Couche DAO (CDI) -->
                <rect x="270" y="280" width="360" height="80" rx="8" ry="8" fill="#9b59b6" stroke="#8e44ad" stroke-width="1"/>
                <text x="450" y="325" font-family="Segoe UI" font-size="14" fill="white" text-anchor="middle">Couche DAO (InMemorySensorReadingDAO - CDI)</text>

                <!-- Navigateur Web (Client) -->
                <g transform="translate(720, 100)">
                    <rect x="0" y="0" width="100" height="60" rx="10" ry="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                    <text x="40" y="35" font-family="Segoe UI" font-size="10" fill="white" text-anchor="middle">Navigateur</text>
                </g>
                <line x1="650" y1="130" x2="700" y2="130" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead)" />
                <text x="685" y="120" font-family="Segoe UI" font-size="10" fill="#3498db" text-anchor="middle">Requête HTTP</text>
                <line x1="780" y1="140" x2="670" y2="140" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead)" />
                <text x="685" y="160" font-family="Segoe UI" font-size="10" fill="#3498db" text-anchor="middle">Réponse HTML</text>

            </svg>
            <p>Ce schéma illustre les interactions entre les capteurs IoT (simulés par le formulaire), l'application JEE structurée en couches (Web, Service, DAO) et le navigateur web de l'utilisateur, le tout conteneurisé avec Docker.</p>
        </div>

        <h2>Étape 1 : Initialisation du Projet et Structure (45 min)</h2>
        <div class="task">
            <h3>Tâche 1.1 : Création du Projet Maven</h3>
            <ol>
                <li>Créez un nouveau projet Maven dans IntelliJ IDEA.</li>
                <li>Choisissez l'archétype <code>jakartaee8-web-app</code> (ou similaire pour Jakarta EE 9/10 si votre serveur le supporte).</li>
                <li>Configurez le <code>pom.xml</code> pour inclure les dépendances nécessaires pour Jakarta EE (Servlet, CDI). Assurez-vous que la version de Jakarta EE correspond à celle de votre serveur d'applications.</li>
                <li>Vérifiez que le projet se compile correctement.</li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> Écosystème JEE/Jakarta EE, Maven, Serveur d'applications.</p>

            <h3>Tâche 1.2 : Définition du Modèle de Données (DTO)</h3>
            <ol>
                <li>Créez une classe Java nommée <code>SensorReading</code> dans un package approprié (ex: <code>com.example.iotplatform.model</code>).</li>
                <li>Ajoutez les attributs mentionnés ci-dessus (<code>readingId</code>, <code>sensorId</code>, <code>sensorType</code>, <code>value</code>, <code>unit</code>, <code>timestamp</code>, <code>location</code>).</li>
                <li>Générez un constructeur, les getters, les setters, <code>equals()</code>, <code>hashCode()</code> et <code>toString()</code> pour cette classe.</li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> Data Transfer Object (DTO), Encapsulation.</p>
        </div>

        <h2>Étape 2 : Couche de Persistance (DAO) et Service Métier (60 min)</h2>
        <div class="task">
            <h3>Tâche 2.1 : Interface DAO pour les Lectures de Capteurs</h3>
            <ol>
                <li>Créez une interface nommée <code>SensorReadingDAO</code> dans un package (ex: <code>com.example.iotplatform.dao</code>).</li>
                <li>Définissez les méthodes suivantes :
                    <ul>
                        <li><code>void addReading(SensorReading reading)</code> : pour ajouter une nouvelle lecture.</li>
                        <li><code>List&lt;SensorReading&gt; getAllReadings()</code> : pour récupérer toutes les lectures.</li>
                        <li><code>SensorReading getReadingById(String readingId)</code> : pour récupérer une lecture par son ID.</li>
                        <li><code>List&lt;SensorReading&gt; getReadingsBySensorId(String sensorId)</code> : pour récupérer les lectures d'un capteur spécifique.</li>
                        <li><code>List&lt;SensorReading&gt; getReadingsBySensorType(String sensorType)</code> : pour récupérer les lectures d'un certain type de capteur.</li>
                    </ul>
                </li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> Data Access Object (DAO), Interface.</p>

            <h3>Tâche 2.2 : Implémentation DAO en Mémoire</h3>
            <ol>
                <li>Créez une classe nommée <code>InMemorySensorReadingDAO</code> qui implémente l'interface <code>SensorReadingDAO</code>.</li>
                <li>Utilisez une <code>ConcurrentHashMap&lt;String, SensorReading&gt;</code> (ou <code>HashMap</code> simple pour ce TP) pour stocker les lectures en mémoire, où la clé est le <code>readingId</code>.</li>
                <li>Implémentez toutes les méthodes de l'interface <code>SensorReadingDAO</code> en utilisant cette map.</li>
                <li>Marquez cette classe avec l'annotation <span class="concept"><code>@ApplicationScoped</code></span> de CDI pour qu'elle soit gérée par le conteneur.</li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> CDI (Contexts and Dependency Injection), Scopes (ApplicationScoped), Implémentation DAO, Collections Java.</p>

            <h3>Tâche 2.3 : Service Métier de Gestion IoT</h3>
            <ol>
                <li>Créez une classe nommée <code>IoTSensorManagerService</code> dans un package (ex: <code>com.example.iotplatform.service</code>).</li>
                <li>Dans cette classe, injectez l'implémentation de <code>SensorReadingDAO</code> en utilisant l'annotation <span class="concept"><code>@Inject</code></span>.
                    <pre><code>@Inject
private SensorReadingDAO sensorReadingDAO;</code></pre>
                </li>
                <li>Définissez des méthodes métier qui délèguent aux méthodes du DAO, par exemple :
                    <ul>
                        <li><code>void ingestSensorReading(SensorReading reading)</code></li>
                        <li><code>List&lt;SensorReading&gt; retrieveAllSensorReadings()</code></li>
                        <li><code>SensorReading findReadingById(String readingId)</code></li>
                        <li><code>List&lt;SensorReading&gt; filterReadingsBySensorType(String sensorType)</code></li>
                        <li><code>List&lt;SensorReading&gt; getLatestReadings(int limit)</code> (implémentez une logique simple pour retourner les dernières lectures ajoutées)</li>
                    </ul>
                </li>
                <li>Marquez cette classe avec l'annotation <span class="concept"><code>@RequestScoped</code></span> ou <span class="concept"><code>@ApplicationScoped</code></span> (<code>@ApplicationScoped</code> est suffisant pour ce TP simple).</li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> Service Layer, CDI (Injection de dépendances), Scopes (RequestScoped/ApplicationScoped).</p>
        </div>

        <h2>Étape 3 : Interface Utilisateur (MVC simplifié) (75 min)</h2>
        <div class="task">
            <h3>Tâche 3.1 : Servlet de Contrôle (Controller)</h3>
            <ol>
                <li>Créez une classe Servlet nommée <code>IoTSensorControllerServlet</code> dans un package (ex: <code>com.example.iotplatform.controller</code>).</li>
                <li>Annotez-la avec <span class="concept"><code>@WebServlet("/iot-dashboard")</code></span> pour la mapper à l'URL <code>/iot-dashboard</code>.</li>
                <li>Injectez votre <code>IoTSensorManagerService</code> dans cette Servlet en utilisant <span class="concept"><code>@Inject</code></span>.
                    <pre><code>@Inject
private IoTSensorManagerService iotSensorManagerService;</code></pre>
                </li>
                <li>Implémentez la méthode <code>doGet(HttpServletRequest request, HttpServletResponse response)</code> :
                    <ul>
                        <li>Récupérez toutes les lectures via <code>iotSensorManagerService.retrieveAllSensorReadings()</code>.</li>
                        <li>Placez la liste des lectures dans l'objet <code>request</code> : <code>request.setAttribute("readings", readingList);</code></li>
                        <li>Faites une redirection vers une page JSP pour l'affichage : <code>request.getRequestDispatcher("/WEB-INF/views/iot-dashboard.jsp").forward(request, response);</code></li>
                    </ul>
                </li>
                <li>Implémentez la méthode <code>doPost(HttpServletRequest request, HttpServletResponse response)</code> :
                    <ul>
                        <li>Récupérez les paramètres du formulaire (<code>sensorId</code>, <code>sensorType</code>, <code>value</code>, <code>unit</code>, <code>location</code>) depuis la requête.</li>
                        <li>Créez un nouvel objet <code>SensorReading</code> avec un <code>readingId</code> unique (ex: <code>UUID.randomUUID().toString()</code>) et l'horodatage actuel (<code>System.currentTimeMillis()</code>).</li>
                        <li>Ingérez la lecture via <code>iotSensorManagerService.ingestSensorReading(newReading);</code></li>
                        <li>Redirigez l'utilisateur vers la page d'affichage des lectures (<code>response.sendRedirect(request.getContextPath() + "/iot-dashboard");</code>).</li>
                    </ul>
                </li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> Servlet, Modèle MVC (Controller), Injection de dépendances (CDI), Cycle de vie des requêtes HTTP (GET/POST).</p>

            <h3>Tâche 3.2 : Page JSP d'Affichage (View)</h3>
            <ol>
                <li>Créez un dossier <code>views</code> sous <code>WEB-INF</code>.</li>
                <li>Créez un fichier <code>iot-dashboard.jsp</code> dans ce dossier.</li>
                <li>Dans <code>iot-dashboard.jsp</code> :
                    <ul>
                        <li>Affichez un titre "Tableau de Bord IoT".</li>
                        <li>Utilisez la JSTL (JavaServer Pages Standard Tag Library) pour itérer sur la liste des lectures passée par la Servlet.
                            <pre><code>&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;
...
&lt;c:forEach var="reading" items="${readings}"&gt;
    &lt;p&gt;ID Lecture: ${reading.readingId}, Capteur: ${reading.sensorId} <br> (${reading.sensorType}), Valeur: ${reading.value} ${reading.unit}, <br>Lieu: ${reading.location}, Timestamp: ${reading.timestamp}&lt;/p&gt;
&lt;/c:forEach&gt;</code></pre>
                        </li>
                        <li>Ajoutez un simple formulaire HTML pour simuler l'ingestion d'une nouvelle lecture (champs pour <code>sensorId</code>, <code>sensorType</code>, <code>value</code>, <code>unit</code>, <code>location</code>). L'action du formulaire doit pointer vers <code>/iot-dashboard</code> avec la méthode POST.</li>
                    </ul>
                </li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> JSP (JavaServer Pages), JSTL, Modèle MVC (View), Formulaires HTML.</p>
        </div>

        <h2>Étape 4 : Déploiement et Conteneurisation (60 min)</h2>
        <div class="task">
            <h3>Tâche 4.1 : Déploiement sur Serveur d'Applications</h3>
            <ol>
                <li>Construisez votre projet Maven (<code>mvn clean package</code>). Cela générera un fichier <code>.war</code>.</li>
                <li>Déployez le fichier <code>.war</code> sur votre serveur WildFly/Payara (via l'interface d'administration ou en le copiant dans le dossier <code>deployments</code>).</li>
                <li>Accédez à l'application via votre navigateur (ex: <code>http://localhost:8080/iotplatform/iot-dashboard</code>).</li>
                <li>Testez l'ingestion et l'affichage des lectures de capteurs.</li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> Déploiement d'applications JEE, Fichier WAR.</p>

            <h3>Tâche 4.2 : Conteneurisation avec Docker</h3>
            <ol>
                <li>Créez un fichier <code>Dockerfile</code> à la racine de votre projet.</li>
                <li>Utilisez une image de base pour votre serveur d'applications (ex: <code>jboss/wildfly:latest</code> ou <code>payara/server-full:latest</code>).</li>
                <li>Copiez votre fichier <code>.war</code> dans le dossier de déploiement du serveur d'applications à l'intérieur du conteneur.
                    <pre><code>FROM jboss/wildfly:latest
COPY target/iotplatform.war /opt/jboss/wildfly/standalone/deployments/</code></pre>
                </li>
                <li>Construisez votre image Docker : <code>docker build -t iot-platform-app .</code></li>
                <li>Exécutez votre conteneur Docker, en mappant le port du serveur d'applications (ex: 8080) : <code>docker run -p 8080:8080 iot-platform-app</code></li>
                <li>Accédez à l'application via <code>http://localhost:8080/iotplatform/iot-dashboard</code> et vérifiez son fonctionnement.</li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> Conteneurisation, Docker, Dockerfile, Images Docker, Exécution de conteneurs.</p>
        </div>

        <h2>Étape 5 : Réflexion et Améliorations (30 min)</h2>
        <div class="task">
            <h3>Tâche 5.1 : Discussion et Questions</h3>
            <p>Répondez aux questions suivantes (pas de code à écrire, juste de la réflexion) :</p>
            <ol>
                <li>Pourquoi avons-nous utilisé une interface <code>SensorReadingDAO</code> et une implémentation <code>InMemorySensorReadingDAO</code> ? Quel est l'avantage de cette approche pour une future intégration Big Data ?</li>
                <li>Quel est le rôle de CDI dans cette application ? Comment facilite-t-il le développement et la testabilité ?</li>
                <li>Si nous devions gérer des millions de lectures par seconde, quelles seraient les limites de notre <code>InMemorySensorReadingDAO</code> ? Quelles technologies Big Data (vues dans le syllabus) pourraient la remplacer ?</li>
                <li>Comment cette architecture simple pourrait-elle être adaptée pour gérer un très grand volume de données IoT ? (Pensez aux limites de la solution actuelle).</li>
                <li>Quels sont les avantages de conteneuriser cette application avec Docker, notamment dans un contexte de déploiement de microservices IoT ?</li>
            </ol>
            <p class="concept"><strong>Concepts utilisés :</strong> Patterns architecturaux (DAO, Service Layer, MVC), Injection de dépendances, Scalabilité, Conteneurisation, Contexte Big Data/IoT.</p>
        </div>

        <div class="warning">
            <strong>Important :</strong> Ce TP est conçu pour être réalisé en une seule séance. Concentrez-vous sur la compréhension des concepts et la mise en œuvre fonctionnelle. Ne vous attardez pas sur des détails esthétiques ou des fonctionnalités avancées. Le but est de valider l'acquisition des bases de JEE et de la conteneurisation dans un contexte IoT.
        </div>
    </div>
</body>
</html>
